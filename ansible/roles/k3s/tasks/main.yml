---

- include: kubeconfig.yml
  tags:
  - kubeconfig

- include: registry.yml
  when:
  - ansible_facts['architecture'] != "aarch64"
  - mirror_registry is defined
    or (private_registries is defined
      and private_registries|length > 0)
  tags:
  - registry

- include: calico.yml
  when:
  - k3s_control_node is defined
  - k3s_control_node
  - calico.enabled is defined
  - calico.enabled
  tags:
  - calico

- include: kube-vip.yml
  when:
  - k3s_control_node is defined
  - k3s_control_node
  - kube_vip.enabled is defined
  - kube_vip.enabled
  tags:
  - kube-vip

- include: secrets.yml
  when:
  - k3s_control_node is defined
  - k3s_control_node
  - k3s_etcd_datastore is defined
  - k3s_etcd_datastore
  tags:
  - secrets
