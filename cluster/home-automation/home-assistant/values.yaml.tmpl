---
podAnnotations:
  secret.reloader.stakater.com/reload: home-assistant-secrets
  backup.velero.io/backup-volumes: config

probes:
  liveness:
    enabled: false
  readiness:
    enabled: false
  startup:
    enabled: false

service:
  type: LoadBalancer
  externalIPs:
  - {{ (datasource "home-assistant").network.advertise_host }}
  externalTrafficPolicy: Local
  additionalPorts:
  - name: sonos
    port: 1400
    targetPort: 1400

ingress:
  enabled: true
  annotations:
    kubernetes.io/ingress.class: external
    external-dns.alpha.kubernetes.io/target: _cname_ext.{{ index (datasource "cluster-vars").domains 0 }}
    external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
    cert-manager.io/cluster-issuer: letsencrypt-production
  hosts:
  - domo.{{ index (datasource "cluster-vars").domains 1 }}
  - domo.{{ index (datasource "cluster-vars").domains 2 }}
  tls:
  - secretName: tls.home-assistant-frontend
    hosts:
    - domo.{{ index (datasource "cluster-vars").domains 1 }}
    - domo.{{ index (datasource "cluster-vars").domains 2 }}

extraEnv:
  TZ: "Europe/Amsterdam"

extraSecretForEnvFrom:
- home-assistant-secrets

persistence:
  enabled: true
  existingClaim: home-assistant-data

postgresql:
  enabled: true
  persistence:
    enabled: true
    existingClaim: home-assistant-postgresql

  postgresqlUsername: {{ (datasource "home-assistant").database.username }}
  postgresqlDatabase: {{ (datasource "home-assistant").database.database }}
  postgresqlPassword: {{ (datasource "home-assistant").database.password }}

  primary:
    podAnnotations:
      backup.velero.io/backup-volumes: data

git:
  enabled: true
  repo: {{ (datasource "home-assistant").git.repo }}
  secret: home-assistant-ssh
  user:
    name: {{ (datasource "home-assistant").git.user.name }}
    email: {{ (datasource "home-assistant").git.user.email }}

vscode:
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: internal
      cert-manager.io/cluster-issuer: letsencrypt-production
      external-dns.alpha.kubernetes.io/target: _cname_int.{{ index (datasource "cluster-vars").domains 0 }}
      nginx.ingress.kubernetes.io/proxy-body-size: "0"
    hosts:
    - code-domo.{{ index (datasource "cluster-vars").domains 1 }}
    - code-domo.{{ index (datasource "cluster-vars").domains 2 }}
    tls:
    - secretName: tls.home-assistant-code
      hosts:
      - code-domo.{{ index (datasource "cluster-vars").domains 1 }}
      - code-domo.{{ index (datasource "cluster-vars").domains 2 }}
