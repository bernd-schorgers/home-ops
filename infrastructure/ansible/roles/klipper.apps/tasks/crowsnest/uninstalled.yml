---
- name: Check if crowsnest.service exists
  ansible.builtin.stat:
    path: /etc/systemd/system/crowsnest.service
  register: var_crowsestservice

- name: Stop crowsnest.service if service exists
  ansible.builtin.systemd:
    name: crowsnest.service
    state: stopped
    enabled: false
  become: true
  when: var_crowsestservice.stat.exists

- name: Remove crowsnest binary
  ansible.builtin.file:
    path: "/usr/local/bin/crowsnest"
    state: absent
  become: true

- name: Remove crowsnest installation
  ansible.builtin.file:
    path: "{{crowsnest_install_path}}"
    state: absent

- name: Remove crowsnest logrotate unit
  ansible.builtin.file:
    path: "/etc/logrotate.d/crowsnest"
    state: absent
  become: true

- name: Remove crowsnest systemd unit
  ansible.builtin.file:
    path: /etc/systemd/system/crowsnest.service
    state: absent
  become: true

- name: Reload systemd daemons
  become: true
  ansible.builtin.systemd:
    daemon_reload: true
  changed_when: false
