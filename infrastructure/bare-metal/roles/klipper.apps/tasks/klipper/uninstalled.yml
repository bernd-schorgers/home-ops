---
- name: Check if klipper.service exists
  ansible.builtin.stat:
    path: /etc/systemd/system/klipper.service
  register: var_klipperservice

- name: Stop klipper.service if service exists
  ansible.builtin.systemd:
    name: klipper.service
    state: stopped
    enabled: false
  become: true
  changed_when: false
  when: var_klipperservice.stat.exists

- name: Remove klipper installation
  ansible.builtin.file:
    path: "{{klipper_install_path}}"
    state: absent

- name: Remove klipper virtualenv
  ansible.builtin.file:
    path: "{{klipper_venv_path}}"
    state: absent

- name: Remove klipper systemd unit
  ansible.builtin.file:
    path: /etc/systemd/system/klipper.service
    state: absent
  become: true

- name: Reload systemd daemons
  become: true
  ansible.builtin.systemd:
    daemon_reload: true
  changed_when: false
