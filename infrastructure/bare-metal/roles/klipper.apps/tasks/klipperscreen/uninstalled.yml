---
- name: Check if KlipperScreen.service exists
  ansible.builtin.stat:
    path: /etc/systemd/system/KlipperScreen.service
  register: var_klipperscreenservice

- name: Stop KlipperScreen.service if service exists
  ansible.builtin.systemd:
    name: KlipperScreen.service
    state: stopped
    enabled: false
  become: true
  when: var_klipperscreenservice.stat.exists

- name: Remove KlipperScreen installation
  ansible.builtin.file:
    path: "{{klipperscreen_install_path}}"
    state: absent

- name: Remove KlipperScreen virtualenv
  ansible.builtin.file:
    path: "{{klipperscreen_venv_path}}"
    state: absent

- name: Remove KlipperScreen systemd unit
  ansible.builtin.file:
    path: /etc/systemd/system/KlipperScreen.service
    state: absent
  become: true

- name: Reload systemd daemons
  become: true
  ansible.builtin.systemd:
    daemon_reload: true
  changed_when: false
