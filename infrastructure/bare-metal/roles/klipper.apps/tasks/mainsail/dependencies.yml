---
- name: Install dependencies on Debian/Ubuntu machines
  become: true
  when:
    - ansible_distribution == 'Debian'
  ansible.builtin.apt:
    update_cache: yes
    name:
      - nginx

- name: Install dependencies on Fedora machines
  become: true
  when:
    - ansible_distribution == 'Fedora'
  ansible.builtin.dnf:
    update_cache: yes
    name:
      - nginx

- name: Manage nginx configuration
  become: true
  ansible.builtin.template:
    src: mainsail/nginx.conf.j2
    dest: /etc/nginx/nginx.conf
    force: true

- name: Permit traffic in default zone for http service
  become: true
  ansible.posix.firewalld:
    service: http
    permanent: yes
    state: enabled
    immediate: true
  when:
    - ansible_distribution == 'Fedora'
