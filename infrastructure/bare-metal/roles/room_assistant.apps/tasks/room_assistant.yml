---
- name: Run room-assistant container
  vars:
    image: "mkerix/room-assistant:{{ room_assistant_version }}"
  block:
    - name: Pull image
      community.docker.docker_image:
        name: "{{ image }}"
        source: pull
        state: present

    - name: Run container
      community.docker.docker_compose:
        project_name: room-assistant
        definition:
          version: '3'
          services:
            room-assistant:
              image: "{{ image }}"
              restart: unless-stopped
              network_mode: host
              volumes:
                - /var/run/dbus:/var/run/dbus
              environment:
                NODE_CONFIG: >
                  {{ room_assistant_config | to_json | string }}
