---
apiVersion: "triliovault.trilio.io/v1"
kind: "ClusterBackupPlan"
metadata:
  name: "cluster"
spec:
  backupComponents:
    - namespace: "downloads"
      retainHelmApps: false
    - namespace: "home-automation"
      retainHelmApps: false

  backupConfig:
    retentionPolicy:
      apiVersion: "triliovault.trilio.io/v1"
      kind: "Policy"
      name: "cluster-retention-policy"
      namespace: "trilio"

    schedulePolicy:
      incrementalBackupPolicy:
        apiVersion: "triliovault.trilio.io/v1"
        kind: "Policy"
        name: "cluster-schedule-policy"
        namespace: "trilio"

    target:
      apiVersion: "triliovault.trilio.io/v1"
      kind: "Target"
      name: "nas"
      namespace: "trilio"

  excludeResources:
    labelSelector:
      - matchExpressions:
          - key: "triliovault.trilio.io/backup"
            operator: "DoesNotExist"
  includeResources:
    labelSelector:
      - matchLabels:
          triliovault.trilio.io/backup: "true"

  retainHelmApps: false
